{% block content %}
  <h1>Welcome, {{ user.name }}!</h1>

  <form>
    <input type="text" id="filterText" placeholder="Filter text" oninput="updatePosts()">
    <button type="button" onclick="updatePosts()">Filter</button>
  </form>

  <h2>Latest Posts</h2>
  <ul id="posts">
    {% for post in posts %}
      <li>
        <h3>{{ post.title }}</h3>
        <p>{{ post.content }}</p>
        <p>Upvotes: {{ post.upvotes }}</p>
        <p>Comment Count: {{ post.comment_count }}</p>
        {% if post.video_link %}
          <p>Video Link: <a href="{{ post.video_link }}">{{ post.video_link }}</a></p>
        {% endif %}
        {% if post.image_link %}
          <p>Image Link: <a href="{{ post.image_link }}">{{ post.image_link }}</a></p>
        {% endif %}
      </li>
    {% endfor %}
  </ul>

  <script>
    function updatePosts() {
      const filterText = document.getElementById('filterText').value.trim().toLowerCase();

      fetch('/dashboard', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ filter_text: filterText })
      })
        .then(response => response.json())
        .then(data => {
          const postsList = document.getElementById('posts');
          postsList.innerHTML = '';
          data.posts.forEach(post => {
            const li = document.createElement('li');
            li.innerHTML = `
              <h3>${post.title}</h3>
              <p>${post.content}</p>
              <p>Upvotes: ${post.upvotes}</p>
              <p>Comment Count: ${post.comment_count}</p>
              ${post.video_link ? `<p>Video Link: <a href="${post.video_link}">${post.video_link}</a></p>` : ''}
              ${post.image_link ? `<p>Image Link: <a href="${post.image_link}">${post.image_link}</a></p>` : ''}
            `;
            postsList.appendChild(li);
          });
        });
    }
  </script>
{% endblock %}
