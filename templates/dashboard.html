{% block content %}
  <h1>Welcome, {{ user.name }}!</h1>

  <form method="POST" action="/dashboard">
    <input type="text" name="filter_text" placeholder="Filter text">
    <button type="submit">Filter</button>
  </form>

  <h2>Latest Posts</h2>
  <ul id="posts">
    {% for post in posts %}
      <li>
        <h3>{{ post.title }}</h3>
        <p>{{ post.content }}</p>
        <p>Upvotes: {{ post.upvotes }}</p>
        <p>Comment Count: {{ post.comment_count }}</p>
        {% if post.video_link %}
          <p>Video Link: <a href="{{ post.video_link }}">{{ post.video_link }}</a></p>
        {% endif %}
        {% if post.image_link %}
          <p>Image Link: <a href="{{ post.image_link }}">{{ post.image_link }}</a></p>
        {% endif %}
      </li>
    {% endfor %}
  </ul>

  <script>
    function updatePosts() {
      fetch('/dashboard', { headers: { 'accept': 'application/json' } })
        .then(response => response.json())
        .then(data => {
          const postsList = document.querySelector('#posts');
          postsList.innerHTML = '';
          data.posts.forEach(post => {
            const li = document.createElement('li');
            li.innerHTML = `
              <h3>${post.title}</h3>
              <p>${post.content}</p>
              <p>Upvotes: ${post.upvotes}</p>
              <p>Comment Count: ${post.comment_count}</p>
              ${post.video_link ? `<p>Video Link: <a href="${post.video_link}">${post.video_link}</a></p>` : ''}
              ${post.image_link ? `<p>Image Link: <a href="${post.image_link}">${post.image_link}</a></p>` : ''}
            `;
            postsList.appendChild(li);
          });
        });
    }

    setInterval(updatePosts, 5000);
  </script>
{% endblock %}
